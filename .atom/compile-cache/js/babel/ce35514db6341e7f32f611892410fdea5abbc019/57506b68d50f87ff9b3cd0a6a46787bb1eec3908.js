'use babel';

MockDate = require('mockdate');

getDate = function (workspaceElement) {
  return workspaceElement.querySelector('.atom-clock-time').textContent;
};

getTooltips = function (workspaceElement) {
  element = workspaceElement.querySelector('.atom-clock');
  return atom.tooltips.findTooltips(element);
};

getTooltipDate = function (workspaceElement) {
  tooltip = getTooltips(workspaceElement)[0];
  return tooltip.getTitle();
};

describe('Atom Clock', function () {

  var workspaceElement = undefined;

  beforeEach(function () {
    workspaceElement = atom.views.getView(atom.workspace);
    jasmine.attachToDOM(workspaceElement);
    MockDate.set('1987-04-11 04:00', -300);

    var statusBar = undefined;
    var AtomClock = undefined;

    waitsForPromise(function () {
      return atom.packages.activatePackage('status-bar').then(function (pack) {
        statusBar = workspaceElement.querySelector('status-bar');
      });
    });

    waitsForPromise(function () {
      return atom.packages.activatePackage('atom-clock').then(function (clk) {
        AtomClock = clk.mainModule;
        AtomClock.consumeStatusBar(statusBar);
      });
    });

    waitsForPromise(function () {
      return atom.workspace.open();
    });
  });

  afterEach(function () {
    MockDate.reset();
  });

  it('should not show the tooltip by default', function () {
    expect(getTooltips(workspaceElement)[0].enabled).toBe(false);
  });

  it('should show the tooltip when configured', function () {
    atom.config.set('atom-clock.showTooltip', true);
    expect(getTooltips(workspaceElement)[0].enabled).toBe(true);
  });

  it('should not show the clock icon by default', function () {
    icon = workspaceElement.querySelector('.atom-clock-icon.icon-clock');
    expect(icon).toBeNull();
  });

  it('should show the clock icon when configured', function () {
    atom.config.set('atom-clock.showClockIcon', true);
    icon = workspaceElement.querySelector('.atom-clock-icon.icon-clock');
    expect(icon).not.toBeNull();
  });

  it('should show the time with the default format', function () {
    date = getDate(workspaceElement);
    expect(date).toBe('4:00');
  });

  it('should show the time in the tooltip with the default format', function () {
    date = getTooltipDate(workspaceElement);
    expect(date.toLowerCase()).toBe('saturday, april 11, 1987 4:00 am');
  });

  it('should change the format of displayed time', function () {
    atom.config.set('atom-clock.dateFormat', 'H:mm:ss');
    date = getDate(workspaceElement);
    expect(date).toBe('4:00:00');

    atom.config.set('atom-clock.dateFormat', 'DD dddd YY H:mm');
    date = getDate(workspaceElement);
    expect(date.toLowerCase()).toBe('11 saturday 87 4:00');
  });

  it('should change the format of the displayed time in the tooltip', function () {
    atom.config.set('atom-clock.tooltipDateFormat', 'H:mm:ss');
    date = getTooltipDate(workspaceElement);
    expect(date).toBe('4:00:00');

    atom.config.set('atom-clock.tooltipDateFormat', 'DD dddd YY H:mm');
    date = getTooltipDate(workspaceElement);
    expect(date.toLowerCase()).toBe('11 saturday 87 4:00');
  });

  it('should change the clock content according with the locale', function () {
    atom.config.set('atom-clock.dateFormat', 'DD dddd YY H:mm');
    atom.config.set('atom-clock.locale', 'it');
    date = getDate(workspaceElement);
    expect(date.toLowerCase()).toBe('11 sabato 87 4:00');
  });

  it('should change the clock content in the tooltip according with the locale', function () {
    atom.config.set('atom-clock.tooltipDateFormat', 'DD dddd YY H:mm');
    atom.config.set('atom-clock.locale', 'it');
    date = getTooltipDate(workspaceElement);
    expect(date.toLowerCase()).toBe('11 sabato 87 4:00');
  });

  it('should change the whether UTC time is displayed', function () {
    atom.config.set('atom-clock.dateFormat', 'ZZ');

    atom.config.set('atom-clock.showUTC', false);
    date = getDate(workspaceElement);
    expect(date.toLowerCase()).toBe('+0500');

    atom.config.set('atom-clock.showUTC', true);
    date = getDate(workspaceElement);
    expect(date.toLowerCase()).toBe('+0000');
  });

  it('should change the whether UTC time is displayed in the tooltip', function () {
    atom.config.set('atom-clock.tooltipDateFormat', 'ZZ');

    atom.config.set('atom-clock.showUTC', false);
    date = getTooltipDate(workspaceElement);
    expect(date.toLowerCase()).toBe('+0500');

    atom.config.set('atom-clock.showUTC', true);
    date = getTooltipDate(workspaceElement);
    expect(date.toLowerCase()).toBe('+0000');
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy90bGFuZGF1Ly5hdG9tL3BhY2thZ2VzL2F0b20tY2xvY2svc3BlYy9hdG9tLWNsb2NrLXZpZXctc3BlYy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxXQUFXLENBQUM7O0FBRVosUUFBUSxHQUFHLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQTs7QUFFOUIsT0FBTyxHQUFHLFVBQVMsZ0JBQWdCLEVBQUU7QUFDbkMsU0FBTyxnQkFBZ0IsQ0FBQyxhQUFhLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxXQUFXLENBQUE7Q0FDdEUsQ0FBQTs7QUFFRCxXQUFXLEdBQUcsVUFBUyxnQkFBZ0IsRUFBRTtBQUN2QyxTQUFPLEdBQUcsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxDQUFBO0FBQ3ZELFNBQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUE7Q0FDM0MsQ0FBQTs7QUFFRCxjQUFjLEdBQUcsVUFBUyxnQkFBZ0IsRUFBRTtBQUMxQyxTQUFPLEdBQUcsV0FBVyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDMUMsU0FBTyxPQUFPLENBQUMsUUFBUSxFQUFFLENBQUE7Q0FDMUIsQ0FBQTs7QUFFRCxRQUFRLENBQUMsWUFBWSxFQUFFLFlBQU07O0FBRTNCLE1BQUksZ0JBQWdCLFlBQUEsQ0FBQTs7QUFFcEIsWUFBVSxDQUFDLFlBQU07QUFDZixvQkFBZ0IsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUE7QUFDckQsV0FBTyxDQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFBO0FBQ3JDLFlBQVEsQ0FBQyxHQUFHLENBQUMsa0JBQWtCLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQTs7QUFFdEMsUUFBSSxTQUFTLFlBQUEsQ0FBQTtBQUNiLFFBQUksU0FBUyxZQUFBLENBQUE7O0FBRWIsbUJBQWUsQ0FBQzthQUFN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QyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUE7O0FBRXhDLFFBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLG9CQUFvQixFQUFFLElBQUksQ0FBQyxDQUFBO0FBQzNDLFFBQUksR0FBRyxjQUFjLENBQUMsZ0JBQWdCLENBQUMsQ0FBQTtBQUN2QyxVQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFBO0dBQ3pDLENBQUMsQ0FBQTtDQUVILENBQUMsQ0FBQSIsImZpbGUiOiIvVXNlcnMvdGxhbmRhdS8uYXRvbS9wYWNrYWdlcy9hdG9tLWNsb2NrL3NwZWMvYXRvbS1jbG9jay12aWV3LXNwZWMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIGJhYmVsJztcblxuTW9ja0RhdGUgPSByZXF1aXJlKCdtb2NrZGF0ZScpXG5cbmdldERhdGUgPSBmdW5jdGlvbih3b3Jrc3BhY2VFbGVtZW50KSB7XG4gIHJldHVybiB3b3Jrc3BhY2VFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hdG9tLWNsb2NrLXRpbWUnKS50ZXh0Q29udGVudFxufVxuXG5nZXRUb29sdGlwcyA9IGZ1bmN0aW9uKHdvcmtzcGFjZUVsZW1lbnQpIHtcbiAgZWxlbWVudCA9IHdvcmtzcGFjZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLmF0b20tY2xvY2snKVxuICByZXR1cm4gYXRvbS50b29sdGlwcy5maW5kVG9vbHRpcHMoZWxlbWVudClcbn1cblxuZ2V0VG9vbHRpcERhdGUgPSBmdW5jdGlvbih3b3Jrc3BhY2VFbGVtZW50KSB7XG4gIHRvb2x0aXAgPSBnZXRUb29sdGlwcyh3b3Jrc3BhY2VFbGVtZW50KVswXVxuICByZXR1cm4gdG9vbHRpcC5nZXRUaXRsZSgpXG59XG5cbmRlc2NyaWJlKCdBdG9tIENsb2NrJywgKCkgPT4ge1xuXG4gIGxldCB3b3Jrc3BhY2VFbGVtZW50XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgd29ya3NwYWNlRWxlbWVudCA9IGF0b20udmlld3MuZ2V0VmlldyhhdG9tLndvcmtzcGFjZSlcbiAgICBqYXNtaW5lLmF0dGFjaFRvRE9NKHdvcmtzcGFjZUVsZW1lbnQpXG4gICAgTW9ja0RhdGUuc2V0KCcxOTg3LTA0LTExIDA0OjAwJywgLTMwMClcblxuICAgIGxldCBzdGF0dXNCYXJcbiAgICBsZXQgQXRvbUNsb2NrXG5cbiAgICB3YWl0c0ZvclByb21pc2UoKCkgPT4gYXRvbS5wYWNrYWdlcy5hY3RpdmF0ZVBhY2thZ2UoJ3N0YXR1cy1iYXInKS50aGVuKChwYWNrKSA9PiB7XG4gICAgICBzdGF0dXNCYXIgPSB3b3Jrc3BhY2VFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3N0YXR1cy1iYXInKVxuICAgIH0pKVxuXG4gICAgd2FpdHNGb3JQcm9taXNlKCgpID0+IGF0b20ucGFja2FnZXMuYWN0aXZhdGVQYWNrYWdlKCdhdG9tLWNsb2NrJykudGhlbigoY2xrKSA9PiB7XG4gICAgICBBdG9tQ2xvY2sgPSBjbGsubWFpbk1vZHVsZVxuICAgICAgQXRvbUNsb2NrLmNvbnN1bWVTdGF0dXNCYXIoc3RhdHVzQmFyKVxuICAgIH0pKVxuXG4gICAgd2FpdHNGb3JQcm9taXNlKCgpID0+IGF0b20ud29ya3NwYWNlLm9wZW4oKSlcbiAgfSlcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIE1vY2tEYXRlLnJlc2V0KClcbiAgfSlcblxuICBpdCgnc2hvdWxkIG5vdCBzaG93IHRoZSB0b29sdGlwIGJ5IGRlZmF1bHQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KGdldFRvb2x0aXBzKHdvcmtzcGFjZUVsZW1lbnQpWzBdLmVuYWJsZWQpLnRvQmUoZmFsc2UpXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCBzaG93IHRoZSB0b29sdGlwIHdoZW4gY29uZmlndXJlZCcsICgpID0+IHtcbiAgICBhdG9tLmNvbmZpZy5zZXQoJ2F0b20tY2xvY2suc2hvd1Rvb2x0aXAnLCB0cnVlKVxuICAgIGV4cGVjdChnZXRUb29sdGlwcyh3b3Jrc3BhY2VFbGVtZW50KVswXS5lbmFibGVkKS50b0JlKHRydWUpXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCBub3Qgc2hvdyB0aGUgY2xvY2sgaWNvbiBieSBkZWZhdWx0JywgKCkgPT4ge1xuICAgIGljb24gPSB3b3Jrc3BhY2VFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hdG9tLWNsb2NrLWljb24uaWNvbi1jbG9jaycpXG4gICAgZXhwZWN0KGljb24pLnRvQmVOdWxsKClcbiAgfSlcblxuICBpdCgnc2hvdWxkIHNob3cgdGhlIGNsb2NrIGljb24gd2hlbiBjb25maWd1cmVkJywgKCkgPT4ge1xuICAgIGF0b20uY29uZmlnLnNldCgnYXRvbS1jbG9jay5zaG93Q2xvY2tJY29uJywgdHJ1ZSlcbiAgICBpY29uID0gd29ya3NwYWNlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuYXRvbS1jbG9jay1pY29uLmljb24tY2xvY2snKVxuICAgIGV4cGVjdChpY29uKS5ub3QudG9CZU51bGwoKVxuICB9KVxuXG4gIGl0KCdzaG91bGQgc2hvdyB0aGUgdGltZSB3aXRoIHRoZSBkZWZhdWx0IGZvcm1hdCcsICgpID0+IHtcbiAgICBkYXRlID0gZ2V0RGF0ZSh3b3Jrc3BhY2VFbGVtZW50KVxuICAgIGV4cGVjdChkYXRlKS50b0JlKCc0OjAwJylcbiAgfSlcblxuICBpdCgnc2hvdWxkIHNob3cgdGhlIHRpbWUgaW4gdGhlIHRvb2x0aXAgd2l0aCB0aGUgZGVmYXVsdCBmb3JtYXQnLCAoKSA9PiB7XG4gICAgZGF0ZSA9IGdldFRvb2x0aXBEYXRlKHdvcmtzcGFjZUVsZW1lbnQpXG4gICAgZXhwZWN0KGRhdGUudG9Mb3dlckNhc2UoKSkudG9CZSgnc2F0dXJkYXksIGFwcmlsIDExLCAxOTg3IDQ6MDAgYW0nKVxuICB9KVxuXG4gIGl0KCdzaG91bGQgY2hhbmdlIHRoZSBmb3JtYXQgb2YgZGlzcGxheWVkIHRpbWUnLCAoKSA9PiB7XG4gICAgYXRvbS5jb25maWcuc2V0KCdhdG9tLWNsb2NrLmRhdGVGb3JtYXQnLCAnSDptbTpzcycpXG4gICAgZGF0ZSA9IGdldERhdGUod29ya3NwYWNlRWxlbWVudClcbiAgICBleHBlY3QoZGF0ZSkudG9CZSgnNDowMDowMCcpXG5cbiAgICBhdG9tLmNvbmZpZy5zZXQoJ2F0b20tY2xvY2suZGF0ZUZvcm1hdCcsICdERCBkZGRkIFlZIEg6bW0nKVxuICAgIGRhdGUgPSBnZXREYXRlKHdvcmtzcGFjZUVsZW1lbnQpXG4gICAgZXhwZWN0KGRhdGUudG9Mb3dlckNhc2UoKSkudG9CZSgnMTEgc2F0dXJkYXkgODcgNDowMCcpXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCBjaGFuZ2UgdGhlIGZvcm1hdCBvZiB0aGUgZGlzcGxheWVkIHRpbWUgaW4gdGhlIHRvb2x0aXAnLCAoKSA9PiB7XG4gICAgYXRvbS5jb25maWcuc2V0KCdhdG9tLWNsb2NrLnRvb2x0aXBEYXRlRm9ybWF0JywgJ0g6bW06c3MnKVxuICAgIGRhdGUgPSBnZXRUb29sdGlwRGF0ZSh3b3Jrc3BhY2VFbGVtZW50KVxuICAgIGV4cGVjdChkYXRlKS50b0JlKCc0OjAwOjAwJylcblxuICAgIGF0b20uY29uZmlnLnNldCgnYXRvbS1jbG9jay50b29sdGlwRGF0ZUZvcm1hdCcsICdERCBkZGRkIFlZIEg6bW0nKVxuICAgIGRhdGUgPSBnZXRUb29sdGlwRGF0ZSh3b3Jrc3BhY2VFbGVtZW50KVxuICAgIGV4cGVjdChkYXRlLnRvTG93ZXJDYXNlKCkpLnRvQmUoJzExIHNhdHVyZGF5IDg3IDQ6MDAnKVxuICB9KVxuXG4gIGl0KCdzaG91bGQgY2hhbmdlIHRoZSBjbG9jayBjb250ZW50IGFjY29yZGluZyB3aXRoIHRoZSBsb2NhbGUnLCAoKSA9PiB7XG4gICAgYXRvbS5jb25maWcuc2V0KCdhdG9tLWNsb2NrLmRhdGVGb3JtYXQnLCAnREQgZGRkZCBZWSBIOm1tJylcbiAgICBhdG9tLmNvbmZpZy5zZXQoJ2F0b20tY2xvY2subG9jYWxlJywgJ2l0JylcbiAgICBkYXRlID0gZ2V0RGF0ZSh3b3Jrc3BhY2VFbGVtZW50KVxuICAgIGV4cGVjdChkYXRlLnRvTG93ZXJDYXNlKCkpLnRvQmUoJzExIHNhYmF0byA4NyA0OjAwJylcbiAgfSlcblxuICBpdCgnc2hvdWxkIGNoYW5nZSB0aGUgY2xvY2sgY29udGVudCBpbiB0aGUgdG9vbHRpcCBhY2NvcmRpbmcgd2l0aCB0aGUgbG9jYWxlJywgKCkgPT4ge1xuICAgIGF0b20uY29uZmlnLnNldCgnYXRvbS1jbG9jay50b29sdGlwRGF0ZUZvcm1hdCcsICdERCBkZGRkIFlZIEg6bW0nKVxuICAgIGF0b20uY29uZmlnLnNldCgnYXRvbS1jbG9jay5sb2NhbGUnLCAnaXQnKVxuICAgIGRhdGUgPSBnZXRUb29sdGlwRGF0ZSh3b3Jrc3BhY2VFbGVtZW50KVxuICAgIGV4cGVjdChkYXRlLnRvTG93ZXJDYXNlKCkpLnRvQmUoJzExIHNhYmF0byA4NyA0OjAwJylcbiAgfSlcblxuICBpdCgnc2hvdWxkIGNoYW5nZSB0aGUgd2hldGhlciBVVEMgdGltZSBpcyBkaXNwbGF5ZWQnLCAoKSA9PiB7XG4gICAgYXRvbS5jb25maWcuc2V0KCdhdG9tLWNsb2NrLmRhdGVGb3JtYXQnLCAnWlonKVxuXG4gICAgYXRvbS5jb25maWcuc2V0KCdhdG9tLWNsb2NrLnNob3dVVEMnLCBmYWxzZSlcbiAgICBkYXRlID0gZ2V0RGF0ZSh3b3Jrc3BhY2VFbGVtZW50KVxuICAgIGV4cGVjdChkYXRlLnRvTG93ZXJDYXNlKCkpLnRvQmUoJyswNTAwJylcblxuICAgIGF0b20uY29uZmlnLnNldCgnYXRvbS1jbG9jay5zaG93VVRDJywgdHJ1ZSlcbiAgICBkYXRlID0gZ2V0RGF0ZSh3b3Jrc3BhY2VFbGVtZW50KVxuICAgIGV4cGVjdChkYXRlLnRvTG93ZXJDYXNlKCkpLnRvQmUoJyswMDAwJylcbiAgfSlcblxuICBpdCgnc2hvdWxkIGNoYW5nZSB0aGUgd2hldGhlciBVVEMgdGltZSBpcyBkaXNwbGF5ZWQgaW4gdGhlIHRvb2x0aXAnLCAoKSA9PiB7XG4gICAgYXRvbS5jb25maWcuc2V0KCdhdG9tLWNsb2NrLnRvb2x0aXBEYXRlRm9ybWF0JywgJ1paJylcblxuICAgIGF0b20uY29uZmlnLnNldCgnYXRvbS1jbG9jay5zaG93VVRDJywgZmFsc2UpXG4gICAgZGF0ZSA9IGdldFRvb2x0aXBEYXRlKHdvcmtzcGFjZUVsZW1lbnQpXG4gICAgZXhwZWN0KGRhdGUudG9Mb3dlckNhc2UoKSkudG9CZSgnKzA1MDAnKVxuXG4gICAgYXRvbS5jb25maWcuc2V0KCdhdG9tLWNsb2NrLnNob3dVVEMnLCB0cnVlKVxuICAgIGRhdGUgPSBnZXRUb29sdGlwRGF0ZSh3b3Jrc3BhY2VFbGVtZW50KVxuICAgIGV4cGVjdChkYXRlLnRvTG93ZXJDYXNlKCkpLnRvQmUoJyswMDAwJylcbiAgfSlcblxufSlcbiJdfQ==