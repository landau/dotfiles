'use babel';

describe('Atom Clock', function () {

  var AtomClock = undefined;
  var workspaceElement = undefined;

  beforeEach(function () {
    workspaceElement = atom.views.getView(atom.workspace);
    jasmine.attachToDOM(workspaceElement);

    var statusBar = undefined;

    waitsForPromise(function () {
      return atom.packages.activatePackage('status-bar').then(function (pack) {
        statusBar = workspaceElement.querySelector('status-bar');
      });
    });

    waitsForPromise(function () {
      return atom.packages.activatePackage('atom-clock').then(function (clk) {
        AtomClock = clk.mainModule;
        AtomClock.consumeStatusBar(statusBar);
      });
    });

    waitsForPromise(function () {
      return atom.workspace.open();
    });
  });

  it('should properly load the package', function () {
    expect(AtomClock.atomClockView.element).toBeDefined();

    expect(AtomClock.config.dateFormat['default']).toBe('H:mm');
    expect(AtomClock.config.showTooltip['default']).toBe(false);
    expect(AtomClock.config.tooltipDateFormat['default']).toBe('LLLL');
    expect(AtomClock.config.locale['default']).toBe('en');
    expect(AtomClock.config.refreshInterval['default']).toBe(60);
    expect(AtomClock.config.showClockIcon['default']).toBe(false);
  });

  it('should refresh the ticker when the date format is changed', function () {
    spyOn(AtomClock.atomClockView, 'refreshTicker');

    atom.config.set('atom-clock.dateFormat', 'H');
    expect(AtomClock.atomClockView.refreshTicker).toHaveBeenCalled();
  });

  it('should refresh the ticker when the tooltip date format is changed', function () {
    spyOn(AtomClock.atomClockView, 'refreshTicker');

    atom.config.set('atom-clock.tooltipDateFormat', 'H');
    expect(AtomClock.atomClockView.refreshTicker).toHaveBeenCalled();
  });

  it('should refresh the ticker when the interval is changed', function () {
    spyOn(AtomClock.atomClockView, 'refreshTicker');

    atom.config.set('atom-clock.refreshInterval', '20');
    expect(AtomClock.atomClockView.refreshTicker).toHaveBeenCalled();
  });

  it('should set the configuration values when the tooltip is enabled', function () {
    spyOn(AtomClock.atomClockView, 'setConfigValues');

    atom.config.set('atom-clock.showTooltip', true);
    expect(AtomClock.atomClockView.setConfigValues).toHaveBeenCalled();
  });

  it('should set the configuration values when clock icon is requested', function () {
    spyOn(AtomClock.atomClockView, 'setConfigValues');

    atom.config.set('atom-clock.showClockIcon', true);
    expect(AtomClock.atomClockView.setConfigValues).toHaveBeenCalled();
  });

  it('should clear the ticker and restart it when refresh is called', function () {
    spyOn(AtomClock.atomClockView, 'clearTicker');
    spyOn(AtomClock.atomClockView, 'startTicker');

    atom.config.set('atom-clock.refreshInterval', '20');
    expect(AtomClock.atomClockView.clearTicker).toHaveBeenCalled();
    expect(AtomClock.atomClockView.startTicker).toHaveBeenCalled();
  });

  it('should hide the clock when toggled', function () {
    atom.commands.dispatch(document.querySelector('atom-workspace'), 'atom-clock:toggle');
    expect(AtomClock.atomClockView.element.style.display).toBe('none');

    atom.commands.dispatch(document.querySelector('atom-workspace'), 'atom-clock:toggle');
    expect(AtomClock.atomClockView.element.style.display).toBe('');
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy90bGFuZGF1Ly5hdG9tL3BhY2thZ2VzL2F0b20tY2xvY2svc3BlYy9hdG9tLWNsb2NrLXNwZWMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsV0FBVyxDQUFDOztBQUVaLFFBQVEsQ0FBQyxZQUFZLEVBQUUsWUFBTTs7QUFFM0IsTUFBSSxTQUFTLFlBQUEsQ0FBQTtBQUNiLE1BQUksZ0JBQWdCLFlBQUEsQ0FBQTs7QUFFcEIsWUFBVSxDQUFDLFlBQU07QUFDZixvQkFBZ0IsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUE7QUFDckQsV0FBTyxDQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFBOztBQUVyQyxRQUFJLFNBQVMsWUFBQSxDQUFBOztBQUViLG1CQUFlLENBQUM7YUFBTSxJQUFJLENBQUMsUUFBUSxDQUFDLGVBQWUsQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBQyxJQUFJLEVBQUs7QUFDL0UsaUJBQVMsR0FBRyxnQkFBZ0IsQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLENBQUE7T0FDekQsQ0FBQztLQUFBLENBQUMsQ0FBQTs7QUFFSCxtQkFBZSxDQUFDO2FBQU0sSUFBSSxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsWUFBWSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUMsR0FBRyxFQUFLO0FBQzlFLGlCQUFTLEdBQUcsR0FBRyxDQUFDLFVBQVUsQ0FBQTtBQUMxQixpQkFBUyxDQUFDLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxDQUFBO09BQ3RDLENBQUM7S0FBQSxDQUFDLENBQUE7O0FBRUgsbUJBQWUsQ0FBQzthQUFNLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFO0tBQUEsQ0FBQyxDQUFBO0dBQzdDLENBQUMsQ0FBQTs7QUFFRixJQUFFLENBQUMsa0NBQWtDLEVBQUUsWUFBTTtBQUMzQyxVQUFNLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FB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LFNBQVMsQ0FBQyxhQUFhLEVBQUUsYUFBYSxDQUFDLENBQUE7O0FBRTdDLFFBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLDRCQUE0QixFQUFFLElBQUksQ0FBQyxDQUFBO0FBQ25ELFVBQU0sQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxDQUFDLGdCQUFnQixFQUFFLENBQUE7QUFDOUQsVUFBTSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQTtHQUMvRCxDQUFDLENBQUE7O0FBRUYsSUFBRSxDQUFDLG9DQUFvQyxFQUFFLFlBQU07QUFDN0MsUUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLG1CQUFtQixDQUFDLENBQUE7QUFDckYsVUFBTSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUE7O0FBRWxFLFFBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsRUFBRSxtQkFBbUIsQ0FBQyxDQUFBO0FBQ3JGLFVBQU0sQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFBO0dBQy9ELENBQUMsQ0FBQTtDQUVILENBQUMsQ0FBQSIsImZpbGUiOiIvVXNlcnMvdGxhbmRhdS8uYXRvbS9wYWNrYWdlcy9hdG9tLWNsb2NrL3NwZWMvYXRvbS1jbG9jay1zcGVjLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBiYWJlbCc7XG5cbmRlc2NyaWJlKCdBdG9tIENsb2NrJywgKCkgPT4ge1xuXG4gIGxldCBBdG9tQ2xvY2tcbiAgbGV0IHdvcmtzcGFjZUVsZW1lbnRcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICB3b3Jrc3BhY2VFbGVtZW50ID0gYXRvbS52aWV3cy5nZXRWaWV3KGF0b20ud29ya3NwYWNlKVxuICAgIGphc21pbmUuYXR0YWNoVG9ET00od29ya3NwYWNlRWxlbWVudClcblxuICAgIGxldCBzdGF0dXNCYXJcblxuICAgIHdhaXRzRm9yUHJvbWlzZSgoKSA9PiBhdG9tLnBhY2thZ2VzLmFjdGl2YXRlUGFja2FnZSgnc3RhdHVzLWJhcicpLnRoZW4oKHBhY2spID0+IHtcbiAgICAgIHN0YXR1c0JhciA9IHdvcmtzcGFjZUVsZW1lbnQucXVlcnlTZWxlY3Rvcignc3RhdHVzLWJhcicpXG4gICAgfSkpXG5cbiAgICB3YWl0c0ZvclByb21pc2UoKCkgPT4gYXRvbS5wYWNrYWdlcy5hY3RpdmF0ZVBhY2thZ2UoJ2F0b20tY2xvY2snKS50aGVuKChjbGspID0+IHtcbiAgICAgIEF0b21DbG9jayA9IGNsay5tYWluTW9kdWxlXG4gICAgICBBdG9tQ2xvY2suY29uc3VtZVN0YXR1c0JhcihzdGF0dXNCYXIpXG4gICAgfSkpXG5cbiAgICB3YWl0c0ZvclByb21pc2UoKCkgPT4gYXRvbS53b3Jrc3BhY2Uub3BlbigpKVxuICB9KVxuXG4gIGl0KCdzaG91bGQgcHJvcGVybHkgbG9hZCB0aGUgcGFja2FnZScsICgpID0+IHtcbiAgICBleHBlY3QoQXRvbUNsb2NrLmF0b21DbG9ja1ZpZXcuZWxlbWVudCkudG9CZURlZmluZWQoKVxuXG4gICAgZXhwZWN0KEF0b21DbG9jay5jb25maWcuZGF0ZUZvcm1hdC5kZWZhdWx0KS50b0JlKCdIOm1tJylcbiAgICBleHBlY3QoQXRvbUNsb2NrLmNvbmZpZy5zaG93VG9vbHRpcC5kZWZhdWx0KS50b0JlKGZhbHNlKVxuICAgIGV4cGVjdChBdG9tQ2xvY2suY29uZmlnLnRvb2x0aXBEYXRlRm9ybWF0LmRlZmF1bHQpLnRvQmUoJ0xMTEwnKVxuICAgIGV4cGVjdChBdG9tQ2xvY2suY29uZmlnLmxvY2FsZS5kZWZhdWx0KS50b0JlKCdlbicpXG4gICAgZXhwZWN0KEF0b21DbG9jay5jb25maWcucmVmcmVzaEludGVydmFsLmRlZmF1bHQpLnRvQmUoNjApXG4gICAgZXhwZWN0KEF0b21DbG9jay5jb25maWcuc2hvd0Nsb2NrSWNvbi5kZWZhdWx0KS50b0JlKGZhbHNlKVxuICB9KVxuXG4gIGl0KCdzaG91bGQgcmVmcmVzaCB0aGUgdGlja2VyIHdoZW4gdGhlIGRhdGUgZm9ybWF0IGlzIGNoYW5nZWQnLCAoKSA9PiB7XG4gICAgc3B5T24oQXRvbUNsb2NrLmF0b21DbG9ja1ZpZXcsICdyZWZyZXNoVGlja2VyJylcblxuICAgIGF0b20uY29uZmlnLnNldCgnYXRvbS1jbG9jay5kYXRlRm9ybWF0JywgJ0gnKVxuICAgIGV4cGVjdChBdG9tQ2xvY2suYXRvbUNsb2NrVmlldy5yZWZyZXNoVGlja2VyKS50b0hhdmVCZWVuQ2FsbGVkKClcbiAgfSlcblxuICBpdCgnc2hvdWxkIHJlZnJlc2ggdGhlIHRpY2tlciB3aGVuIHRoZSB0b29sdGlwIGRhdGUgZm9ybWF0IGlzIGNoYW5nZWQnLCAoKSA9PiB7XG4gICAgc3B5T24oQXRvbUNsb2NrLmF0b21DbG9ja1ZpZXcsICdyZWZyZXNoVGlja2VyJylcblxuICAgIGF0b20uY29uZmlnLnNldCgnYXRvbS1jbG9jay50b29sdGlwRGF0ZUZvcm1hdCcsICdIJylcbiAgICBleHBlY3QoQXRvbUNsb2NrLmF0b21DbG9ja1ZpZXcucmVmcmVzaFRpY2tlcikudG9IYXZlQmVlbkNhbGxlZCgpXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCByZWZyZXNoIHRoZSB0aWNrZXIgd2hlbiB0aGUgaW50ZXJ2YWwgaXMgY2hhbmdlZCcsICgpID0+IHtcbiAgICBzcHlPbihBdG9tQ2xvY2suYXRvbUNsb2NrVmlldywgJ3JlZnJlc2hUaWNrZXInKVxuXG4gICAgYXRvbS5jb25maWcuc2V0KCdhdG9tLWNsb2NrLnJlZnJlc2hJbnRlcnZhbCcsICcyMCcpXG4gICAgZXhwZWN0KEF0b21DbG9jay5hdG9tQ2xvY2tWaWV3LnJlZnJlc2hUaWNrZXIpLnRvSGF2ZUJlZW5DYWxsZWQoKVxuICB9KVxuXG4gIGl0KCdzaG91bGQgc2V0IHRoZSBjb25maWd1cmF0aW9uIHZhbHVlcyB3aGVuIHRoZSB0b29sdGlwIGlzIGVuYWJsZWQnLCAoKSA9PiB7XG4gICAgc3B5T24oQXRvbUNsb2NrLmF0b21DbG9ja1ZpZXcsICdzZXRDb25maWdWYWx1ZXMnKVxuXG4gICAgYXRvbS5jb25maWcuc2V0KCdhdG9tLWNsb2NrLnNob3dUb29sdGlwJywgdHJ1ZSlcbiAgICBleHBlY3QoQXRvbUNsb2NrLmF0b21DbG9ja1ZpZXcuc2V0Q29uZmlnVmFsdWVzKS50b0hhdmVCZWVuQ2FsbGVkKClcbiAgfSlcblxuICBpdCgnc2hvdWxkIHNldCB0aGUgY29uZmlndXJhdGlvbiB2YWx1ZXMgd2hlbiBjbG9jayBpY29uIGlzIHJlcXVlc3RlZCcsICgpID0+IHtcbiAgICBzcHlPbihBdG9tQ2xvY2suYXRvbUNsb2NrVmlldywgJ3NldENvbmZpZ1ZhbHVlcycpXG5cbiAgICBhdG9tLmNvbmZpZy5zZXQoJ2F0b20tY2xvY2suc2hvd0Nsb2NrSWNvbicsIHRydWUpXG4gICAgZXhwZWN0KEF0b21DbG9jay5hdG9tQ2xvY2tWaWV3LnNldENvbmZpZ1ZhbHVlcykudG9IYXZlQmVlbkNhbGxlZCgpXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCBjbGVhciB0aGUgdGlja2VyIGFuZCByZXN0YXJ0IGl0IHdoZW4gcmVmcmVzaCBpcyBjYWxsZWQnLCAoKSA9PiB7XG4gICAgc3B5T24oQXRvbUNsb2NrLmF0b21DbG9ja1ZpZXcsICdjbGVhclRpY2tlcicpXG4gICAgc3B5T24oQXRvbUNsb2NrLmF0b21DbG9ja1ZpZXcsICdzdGFydFRpY2tlcicpXG5cbiAgICBhdG9tLmNvbmZpZy5zZXQoJ2F0b20tY2xvY2sucmVmcmVzaEludGVydmFsJywgJzIwJylcbiAgICBleHBlY3QoQXRvbUNsb2NrLmF0b21DbG9ja1ZpZXcuY2xlYXJUaWNrZXIpLnRvSGF2ZUJlZW5DYWxsZWQoKVxuICAgIGV4cGVjdChBdG9tQ2xvY2suYXRvbUNsb2NrVmlldy5zdGFydFRpY2tlcikudG9IYXZlQmVlbkNhbGxlZCgpXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCBoaWRlIHRoZSBjbG9jayB3aGVuIHRvZ2dsZWQnLCAoKSA9PiB7XG4gICAgYXRvbS5jb21tYW5kcy5kaXNwYXRjaChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdhdG9tLXdvcmtzcGFjZScpLCAnYXRvbS1jbG9jazp0b2dnbGUnKVxuICAgIGV4cGVjdChBdG9tQ2xvY2suYXRvbUNsb2NrVmlldy5lbGVtZW50LnN0eWxlLmRpc3BsYXkpLnRvQmUoJ25vbmUnKVxuXG4gICAgYXRvbS5jb21tYW5kcy5kaXNwYXRjaChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdhdG9tLXdvcmtzcGFjZScpLCAnYXRvbS1jbG9jazp0b2dnbGUnKVxuICAgIGV4cGVjdChBdG9tQ2xvY2suYXRvbUNsb2NrVmlldy5lbGVtZW50LnN0eWxlLmRpc3BsYXkpLnRvQmUoJycpXG4gIH0pXG5cbn0pXG4iXX0=