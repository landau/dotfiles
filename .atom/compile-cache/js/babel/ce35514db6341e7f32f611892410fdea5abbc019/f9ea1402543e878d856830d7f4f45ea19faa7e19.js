'use babel';

MockDate = require('mockdate');

getDate = function (workspaceElement) {
  return workspaceElement.querySelector('.atom-clock-time').textContent;
};

getTooltips = function (workspaceElement) {
  element = workspaceElement.querySelector('.atom-clock');
  return atom.tooltips.findTooltips(element);
};

getTooltipDate = function (workspaceElement) {
  tooltip = getTooltips(workspaceElement)[0];
  return tooltip.getTitle();
};

describe('Atom Clock', function () {

  var workspaceElement = undefined;

  beforeEach(function () {
    workspaceElement = atom.views.getView(atom.workspace);
    jasmine.attachToDOM(workspaceElement);
    MockDate.set('1987-04-11 04:00', -300);

    var statusBar = undefined;
    var AtomClock = undefined;

    waitsForPromise(function () {
      return atom.packages.activatePackage('status-bar').then(function (pack) {
        statusBar = workspaceElement.querySelector('status-bar');
      });
    });

    waitsForPromise(function () {
      return atom.packages.activatePackage('atom-clock').then(function (clk) {
        AtomClock = clk.mainModule;
        AtomClock.consumeStatusBar(statusBar);
      });
    });

    waitsForPromise(function () {
      return atom.workspace.open();
    });
  });

  afterEach(function () {
    MockDate.reset();
  });

  it('should not show the tooltip by default', function () {
    expect(getTooltips(workspaceElement)[0].enabled).toBe(false);
  });

  it('should show the tooltip when configured', function () {
    atom.config.set('atom-clock.showTooltip', true);
    expect(getTooltips(workspaceElement)[0].enabled).toBe(true);
  });

  it('should not show the clock icon by default', function () {
    icon = workspaceElement.querySelector('.atom-clock-icon.icon-clock');
    expect(icon).toBeNull();
  });

  it('should show the clock icon when configured', function () {
    atom.config.set('atom-clock.showClockIcon', true);
    icon = workspaceElement.querySelector('.atom-clock-icon.icon-clock');
    expect(icon).not.toBeNull();
  });

  it('should show the time with the default format', function () {
    date = getDate(workspaceElement);
    expect(date).toBe('4:00');
  });

  it('should show the time in the tooltip with the default format', function () {
    date = getTooltipDate(workspaceElement);
    expect(date.toLowerCase()).toBe('saturday, april 11, 1987 4:00 am');
  });

  it('should change the format of displayed time', function () {
    atom.config.set('atom-clock.dateFormat', 'H:mm:ss');
    date = getDate(workspaceElement);
    expect(date).toBe('4:00:00');

    atom.config.set('atom-clock.dateFormat', 'DD dddd YY H:mm');
    date = getDate(workspaceElement);
    expect(date.toLowerCase()).toBe('11 saturday 87 4:00');
  });

  it('should change the format of the displayed time in the tooltip', function () {
    atom.config.set('atom-clock.tooltipDateFormat', 'H:mm:ss');
    date = getTooltipDate(workspaceElement);
    expect(date).toBe('4:00:00');

    atom.config.set('atom-clock.tooltipDateFormat', 'DD dddd YY H:mm');
    date = getTooltipDate(workspaceElement);
    expect(date.toLowerCase()).toBe('11 saturday 87 4:00');
  });

  it('should change the clock content according with the locale', function () {
    atom.config.set('atom-clock.dateFormat', 'DD dddd YY H:mm');
    atom.config.set('atom-clock.locale', 'it');
    date = getDate(workspaceElement);
    expect(date.toLowerCase()).toBe('11 sabato 87 4:00');
  });

  it('should change the clock content in the tooltip according with the locale', function () {
    atom.config.set('atom-clock.tooltipDateFormat', 'DD dddd YY H:mm');
    atom.config.set('atom-clock.locale', 'it');
    date = getTooltipDate(workspaceElement);
    expect(date.toLowerCase()).toBe('11 sabato 87 4:00');
  });

  it('should change the whether UTC time is displayed', function () {
    atom.config.set('atom-clock.dateFormat', 'ZZ');

    atom.config.set('atom-clock.showUTC', false);
    date = getDate(workspaceElement);
    expect(date.toLowerCase()).toBe('+0500');

    atom.config.set('atom-clock.showUTC', true);
    date = getDate(workspaceElement);
    expect(date.toLowerCase()).toBe('+0000');
  });

  it('should change the whether UTC time is displayed in the tooltip', function () {
    atom.config.set('atom-clock.tooltipDateFormat', 'ZZ');

    atom.config.set('atom-clock.showUTC', false);
    date = getTooltipDate(workspaceElement);
    expect(date.toLowerCase()).toBe('+0500');

    atom.config.set('atom-clock.showUTC', true);
    date = getTooltipDate(workspaceElement);
    expect(date.toLowerCase()).toBe('+0000');
  });

  it('should add atom-clock-utc class to the time when UTC is enabled', function () {
    expect(workspaceElement.querySelector('.atom-clock.atom-clock-utc')).not.toExist();

    atom.config.set('atom-clock.showUTC', true);
    expect(workspaceElement.querySelector('.atom-clock.atom-clock-utc')).toExist();
  });

  it('should add atom-clock-utc class to the tooltip when UTC is enabled', function () {
    expect(getTooltips(workspaceElement)[0].getTooltipElement().classList.contains('atom-clock-utc')).toBe(false);

    atom.config.set('atom-clock.showUTC', true);
    expect(getTooltips(workspaceElement)[0].getTooltipElement().classList.contains('atom-clock-utc')).toBe(true);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy90bGFuZGF1Ly5hdG9tL3BhY2thZ2VzL2F0b20tY2xvY2svc3BlYy9hdG9tLWNsb2NrLXZpZXctc3BlYy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxXQUFXLENBQUM7O0FBRVosUUFBUSxHQUFHLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQTs7QUFFOUIsT0FBTyxHQUFHLFVBQVMsZ0JBQWdCLEVBQUU7QUFDbkMsU0FBTyxnQkFBZ0IsQ0FBQyxhQUFhLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxXQUFXLENBQUE7Q0FDdEUsQ0FBQTs7QUFFRCxXQUFXLEdBQUcsVUFBUyxnQkFBZ0IsRUFBRTtBQUN2QyxTQUFPLEdBQUcsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxDQUFBO0FBQ3ZELFNBQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUE7Q0FDM0MsQ0FBQTs7QUFFRCxjQUFjLEdBQUcsVUFBUyxnQkFBZ0IsRUFBRTtBQUMxQyxTQUFPLEdBQUcsV0FBVyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDMUMsU0FBTyxPQUFPLENBQUMsUUFBUSxFQUFFLENBQUE7Q0FDMUIsQ0FBQTs7QUFFRCxRQUFRLENBQUMsWUFBWSxFQUFFLFlBQU07O0FBRTNCLE1BQUksZ0JBQWdCLFlBQUEsQ0FBQTs7QUFFcEIsWUFBVSxDQUFDLFlBQU07QUFDZixvQkFBZ0IsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUE7QUFDckQsV0FBTyxDQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFBO0FBQ3JDLFlBQVEsQ0FBQyxHQUFHLENBQUMsa0JBQWtCLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQTs7QUFFdEMsUUFBSSxTQUFTLFlBQUEsQ0FBQTtBQUNiLFFBQUksU0FBUyxZQUFBLENBQUE7O0FBRWIsbUJBQWUsQ0FBQzthQUFN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Q0FBQTtHQUM3RyxDQUFDLENBQUE7Q0FFSCxDQUFDLENBQUEiLCJmaWxlIjoiL1VzZXJzL3RsYW5kYXUvLmF0b20vcGFja2FnZXMvYXRvbS1jbG9jay9zcGVjL2F0b20tY2xvY2stdmlldy1zcGVjLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBiYWJlbCc7XG5cbk1vY2tEYXRlID0gcmVxdWlyZSgnbW9ja2RhdGUnKVxuXG5nZXREYXRlID0gZnVuY3Rpb24od29ya3NwYWNlRWxlbWVudCkge1xuICByZXR1cm4gd29ya3NwYWNlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuYXRvbS1jbG9jay10aW1lJykudGV4dENvbnRlbnRcbn1cblxuZ2V0VG9vbHRpcHMgPSBmdW5jdGlvbih3b3Jrc3BhY2VFbGVtZW50KSB7XG4gIGVsZW1lbnQgPSB3b3Jrc3BhY2VFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hdG9tLWNsb2NrJylcbiAgcmV0dXJuIGF0b20udG9vbHRpcHMuZmluZFRvb2x0aXBzKGVsZW1lbnQpXG59XG5cbmdldFRvb2x0aXBEYXRlID0gZnVuY3Rpb24od29ya3NwYWNlRWxlbWVudCkge1xuICB0b29sdGlwID0gZ2V0VG9vbHRpcHMod29ya3NwYWNlRWxlbWVudClbMF1cbiAgcmV0dXJuIHRvb2x0aXAuZ2V0VGl0bGUoKVxufVxuXG5kZXNjcmliZSgnQXRvbSBDbG9jaycsICgpID0+IHtcblxuICBsZXQgd29ya3NwYWNlRWxlbWVudFxuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIHdvcmtzcGFjZUVsZW1lbnQgPSBhdG9tLnZpZXdzLmdldFZpZXcoYXRvbS53b3Jrc3BhY2UpXG4gICAgamFzbWluZS5hdHRhY2hUb0RPTSh3b3Jrc3BhY2VFbGVtZW50KVxuICAgIE1vY2tEYXRlLnNldCgnMTk4Ny0wNC0xMSAwNDowMCcsIC0zMDApXG5cbiAgICBsZXQgc3RhdHVzQmFyXG4gICAgbGV0IEF0b21DbG9ja1xuXG4gICAgd2FpdHNGb3JQcm9taXNlKCgpID0+IGF0b20ucGFja2FnZXMuYWN0aXZhdGVQYWNrYWdlKCdzdGF0dXMtYmFyJykudGhlbigocGFjaykgPT4ge1xuICAgICAgc3RhdHVzQmFyID0gd29ya3NwYWNlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdzdGF0dXMtYmFyJylcbiAgICB9KSlcblxuICAgIHdhaXRzRm9yUHJvbWlzZSgoKSA9PiBhdG9tLnBhY2thZ2VzLmFjdGl2YXRlUGFja2FnZSgnYXRvbS1jbG9jaycpLnRoZW4oKGNsaykgPT4ge1xuICAgICAgQXRvbUNsb2NrID0gY2xrLm1haW5Nb2R1bGVcbiAgICAgIEF0b21DbG9jay5jb25zdW1lU3RhdHVzQmFyKHN0YXR1c0JhcilcbiAgICB9KSlcblxuICAgIHdhaXRzRm9yUHJvbWlzZSgoKSA9PiBhdG9tLndvcmtzcGFjZS5vcGVuKCkpXG4gIH0pXG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBNb2NrRGF0ZS5yZXNldCgpXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCBub3Qgc2hvdyB0aGUgdG9vbHRpcCBieSBkZWZhdWx0JywgKCkgPT4ge1xuICAgIGV4cGVjdChnZXRUb29sdGlwcyh3b3Jrc3BhY2VFbGVtZW50KVswXS5lbmFibGVkKS50b0JlKGZhbHNlKVxuICB9KVxuXG4gIGl0KCdzaG91bGQgc2hvdyB0aGUgdG9vbHRpcCB3aGVuIGNvbmZpZ3VyZWQnLCAoKSA9PiB7XG4gICAgYXRvbS5jb25maWcuc2V0KCdhdG9tLWNsb2NrLnNob3dUb29sdGlwJywgdHJ1ZSlcbiAgICBleHBlY3QoZ2V0VG9vbHRpcHMod29ya3NwYWNlRWxlbWVudClbMF0uZW5hYmxlZCkudG9CZSh0cnVlKVxuICB9KVxuXG4gIGl0KCdzaG91bGQgbm90IHNob3cgdGhlIGNsb2NrIGljb24gYnkgZGVmYXVsdCcsICgpID0+IHtcbiAgICBpY29uID0gd29ya3NwYWNlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuYXRvbS1jbG9jay1pY29uLmljb24tY2xvY2snKVxuICAgIGV4cGVjdChpY29uKS50b0JlTnVsbCgpXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCBzaG93IHRoZSBjbG9jayBpY29uIHdoZW4gY29uZmlndXJlZCcsICgpID0+IHtcbiAgICBhdG9tLmNvbmZpZy5zZXQoJ2F0b20tY2xvY2suc2hvd0Nsb2NrSWNvbicsIHRydWUpXG4gICAgaWNvbiA9IHdvcmtzcGFjZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLmF0b20tY2xvY2staWNvbi5pY29uLWNsb2NrJylcbiAgICBleHBlY3QoaWNvbikubm90LnRvQmVOdWxsKClcbiAgfSlcblxuICBpdCgnc2hvdWxkIHNob3cgdGhlIHRpbWUgd2l0aCB0aGUgZGVmYXVsdCBmb3JtYXQnLCAoKSA9PiB7XG4gICAgZGF0ZSA9IGdldERhdGUod29ya3NwYWNlRWxlbWVudClcbiAgICBleHBlY3QoZGF0ZSkudG9CZSgnNDowMCcpXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCBzaG93IHRoZSB0aW1lIGluIHRoZSB0b29sdGlwIHdpdGggdGhlIGRlZmF1bHQgZm9ybWF0JywgKCkgPT4ge1xuICAgIGRhdGUgPSBnZXRUb29sdGlwRGF0ZSh3b3Jrc3BhY2VFbGVtZW50KVxuICAgIGV4cGVjdChkYXRlLnRvTG93ZXJDYXNlKCkpLnRvQmUoJ3NhdHVyZGF5LCBhcHJpbCAxMSwgMTk4NyA0OjAwIGFtJylcbiAgfSlcblxuICBpdCgnc2hvdWxkIGNoYW5nZSB0aGUgZm9ybWF0IG9mIGRpc3BsYXllZCB0aW1lJywgKCkgPT4ge1xuICAgIGF0b20uY29uZmlnLnNldCgnYXRvbS1jbG9jay5kYXRlRm9ybWF0JywgJ0g6bW06c3MnKVxuICAgIGRhdGUgPSBnZXREYXRlKHdvcmtzcGFjZUVsZW1lbnQpXG4gICAgZXhwZWN0KGRhdGUpLnRvQmUoJzQ6MDA6MDAnKVxuXG4gICAgYXRvbS5jb25maWcuc2V0KCdhdG9tLWNsb2NrLmRhdGVGb3JtYXQnLCAnREQgZGRkZCBZWSBIOm1tJylcbiAgICBkYXRlID0gZ2V0RGF0ZSh3b3Jrc3BhY2VFbGVtZW50KVxuICAgIGV4cGVjdChkYXRlLnRvTG93ZXJDYXNlKCkpLnRvQmUoJzExIHNhdHVyZGF5IDg3IDQ6MDAnKVxuICB9KVxuXG4gIGl0KCdzaG91bGQgY2hhbmdlIHRoZSBmb3JtYXQgb2YgdGhlIGRpc3BsYXllZCB0aW1lIGluIHRoZSB0b29sdGlwJywgKCkgPT4ge1xuICAgIGF0b20uY29uZmlnLnNldCgnYXRvbS1jbG9jay50b29sdGlwRGF0ZUZvcm1hdCcsICdIOm1tOnNzJylcbiAgICBkYXRlID0gZ2V0VG9vbHRpcERhdGUod29ya3NwYWNlRWxlbWVudClcbiAgICBleHBlY3QoZGF0ZSkudG9CZSgnNDowMDowMCcpXG5cbiAgICBhdG9tLmNvbmZpZy5zZXQoJ2F0b20tY2xvY2sudG9vbHRpcERhdGVGb3JtYXQnLCAnREQgZGRkZCBZWSBIOm1tJylcbiAgICBkYXRlID0gZ2V0VG9vbHRpcERhdGUod29ya3NwYWNlRWxlbWVudClcbiAgICBleHBlY3QoZGF0ZS50b0xvd2VyQ2FzZSgpKS50b0JlKCcxMSBzYXR1cmRheSA4NyA0OjAwJylcbiAgfSlcblxuICBpdCgnc2hvdWxkIGNoYW5nZSB0aGUgY2xvY2sgY29udGVudCBhY2NvcmRpbmcgd2l0aCB0aGUgbG9jYWxlJywgKCkgPT4ge1xuICAgIGF0b20uY29uZmlnLnNldCgnYXRvbS1jbG9jay5kYXRlRm9ybWF0JywgJ0REIGRkZGQgWVkgSDptbScpXG4gICAgYXRvbS5jb25maWcuc2V0KCdhdG9tLWNsb2NrLmxvY2FsZScsICdpdCcpXG4gICAgZGF0ZSA9IGdldERhdGUod29ya3NwYWNlRWxlbWVudClcbiAgICBleHBlY3QoZGF0ZS50b0xvd2VyQ2FzZSgpKS50b0JlKCcxMSBzYWJhdG8gODcgNDowMCcpXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCBjaGFuZ2UgdGhlIGNsb2NrIGNvbnRlbnQgaW4gdGhlIHRvb2x0aXAgYWNjb3JkaW5nIHdpdGggdGhlIGxvY2FsZScsICgpID0+IHtcbiAgICBhdG9tLmNvbmZpZy5zZXQoJ2F0b20tY2xvY2sudG9vbHRpcERhdGVGb3JtYXQnLCAnREQgZGRkZCBZWSBIOm1tJylcbiAgICBhdG9tLmNvbmZpZy5zZXQoJ2F0b20tY2xvY2subG9jYWxlJywgJ2l0JylcbiAgICBkYXRlID0gZ2V0VG9vbHRpcERhdGUod29ya3NwYWNlRWxlbWVudClcbiAgICBleHBlY3QoZGF0ZS50b0xvd2VyQ2FzZSgpKS50b0JlKCcxMSBzYWJhdG8gODcgNDowMCcpXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCBjaGFuZ2UgdGhlIHdoZXRoZXIgVVRDIHRpbWUgaXMgZGlzcGxheWVkJywgKCkgPT4ge1xuICAgIGF0b20uY29uZmlnLnNldCgnYXRvbS1jbG9jay5kYXRlRm9ybWF0JywgJ1paJylcblxuICAgIGF0b20uY29uZmlnLnNldCgnYXRvbS1jbG9jay5zaG93VVRDJywgZmFsc2UpXG4gICAgZGF0ZSA9IGdldERhdGUod29ya3NwYWNlRWxlbWVudClcbiAgICBleHBlY3QoZGF0ZS50b0xvd2VyQ2FzZSgpKS50b0JlKCcrMDUwMCcpXG5cbiAgICBhdG9tLmNvbmZpZy5zZXQoJ2F0b20tY2xvY2suc2hvd1VUQycsIHRydWUpXG4gICAgZGF0ZSA9IGdldERhdGUod29ya3NwYWNlRWxlbWVudClcbiAgICBleHBlY3QoZGF0ZS50b0xvd2VyQ2FzZSgpKS50b0JlKCcrMDAwMCcpXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCBjaGFuZ2UgdGhlIHdoZXRoZXIgVVRDIHRpbWUgaXMgZGlzcGxheWVkIGluIHRoZSB0b29sdGlwJywgKCkgPT4ge1xuICAgIGF0b20uY29uZmlnLnNldCgnYXRvbS1jbG9jay50b29sdGlwRGF0ZUZvcm1hdCcsICdaWicpXG5cbiAgICBhdG9tLmNvbmZpZy5zZXQoJ2F0b20tY2xvY2suc2hvd1VUQycsIGZhbHNlKVxuICAgIGRhdGUgPSBnZXRUb29sdGlwRGF0ZSh3b3Jrc3BhY2VFbGVtZW50KVxuICAgIGV4cGVjdChkYXRlLnRvTG93ZXJDYXNlKCkpLnRvQmUoJyswNTAwJylcblxuICAgIGF0b20uY29uZmlnLnNldCgnYXRvbS1jbG9jay5zaG93VVRDJywgdHJ1ZSlcbiAgICBkYXRlID0gZ2V0VG9vbHRpcERhdGUod29ya3NwYWNlRWxlbWVudClcbiAgICBleHBlY3QoZGF0ZS50b0xvd2VyQ2FzZSgpKS50b0JlKCcrMDAwMCcpXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCBhZGQgYXRvbS1jbG9jay11dGMgY2xhc3MgdG8gdGhlIHRpbWUgd2hlbiBVVEMgaXMgZW5hYmxlZCcsICgpID0+IHtcbiAgICBleHBlY3Qod29ya3NwYWNlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuYXRvbS1jbG9jay5hdG9tLWNsb2NrLXV0YycpKS5ub3QudG9FeGlzdCgpXG5cbiAgICBhdG9tLmNvbmZpZy5zZXQoJ2F0b20tY2xvY2suc2hvd1VUQycsIHRydWUpXG4gICAgZXhwZWN0KHdvcmtzcGFjZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLmF0b20tY2xvY2suYXRvbS1jbG9jay11dGMnKSkudG9FeGlzdCgpXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCBhZGQgYXRvbS1jbG9jay11dGMgY2xhc3MgdG8gdGhlIHRvb2x0aXAgd2hlbiBVVEMgaXMgZW5hYmxlZCcsICgpID0+IHtcbiAgICBleHBlY3QoZ2V0VG9vbHRpcHMod29ya3NwYWNlRWxlbWVudClbMF0uZ2V0VG9vbHRpcEVsZW1lbnQoKS5jbGFzc0xpc3QuY29udGFpbnMoJ2F0b20tY2xvY2stdXRjJykpLnRvQmUoZmFsc2UpXG5cbiAgICBhdG9tLmNvbmZpZy5zZXQoJ2F0b20tY2xvY2suc2hvd1VUQycsIHRydWUpXG4gICAgZXhwZWN0KGdldFRvb2x0aXBzKHdvcmtzcGFjZUVsZW1lbnQpWzBdLmdldFRvb2x0aXBFbGVtZW50KCkuY2xhc3NMaXN0LmNvbnRhaW5zKCdhdG9tLWNsb2NrLXV0YycpKS50b0JlKHRydWUpXG4gIH0pXG5cbn0pXG4iXX0=