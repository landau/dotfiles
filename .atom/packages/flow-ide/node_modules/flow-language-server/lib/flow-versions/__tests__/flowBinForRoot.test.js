'use strict';

var _asyncToGenerator = require('async-to-generator');

var _asyncToGenerator2 = _interopRequireDefault(_asyncToGenerator);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _flowBinForRoot = require('../flowBinForRoot');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */

describe('flowBinForRoot', () => {
  let mockReporter;
  beforeEach(() => {
    mockReporter = {
      info: jest.fn(),
      error: jest.fn(),
      warn: jest.fn()
    };
  });

  describe('flowSemverForPath', () => {
    it("returns the flowconfig's version without a message when only a flowconfig is present", (0, _asyncToGenerator2.default)(function* () {
      const resolved = yield (0, _flowBinForRoot._flowSemverForRootPath)(_path2.default.join(__dirname, 'fixtures', 'only-flowconfig'), mockReporter);
      expect(resolved).toBe('0.47.0');
      // $FlowFixMe
      expect(mockReporter.info.mock.calls).toMatchSnapshot();
      expect(mockReporter.warn).not.toHaveBeenCalled();
    }));

    it("returns the package.json's version without a message when only the package.json version is present", (0, _asyncToGenerator2.default)(function* () {
      const resolved = yield (0, _flowBinForRoot._flowSemverForRootPath)(_path2.default.join(__dirname, 'fixtures', 'only-packagejson'), mockReporter);
      expect(resolved).toBe('^0.47.0');
      // $FlowFixMe
      expect(mockReporter.info.mock.calls).toMatchSnapshot();
      expect(mockReporter.warn).not.toHaveBeenCalled();
    }));

    it("returns the flowconfig's version with a message when both flowconfig and package.json dependency are present", (0, _asyncToGenerator2.default)(function* () {
      const resolved = yield (0, _flowBinForRoot._flowSemverForRootPath)(_path2.default.join(__dirname, 'fixtures', 'flowconfig-and-packagejson'), mockReporter);
      expect(resolved).toBe('0.47.0');
      // $FlowFixMe
      expect(mockReporter.info.mock.calls).toMatchSnapshot();
    }));

    it('returns * (indicating to download latest) when no version is present, and warns the user', (0, _asyncToGenerator2.default)(function* () {
      const resolved = yield (0, _flowBinForRoot._flowSemverForRootPath)(_path2.default.join(__dirname, 'fixtures', 'no-versions'), mockReporter);
      expect(resolved).toBe('*');
      expect(mockReporter.warn).toHaveBeenCalled();
    }));
  });
});
//# sourceMappingURL=flowBinForRoot.test.js.map